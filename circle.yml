dependencies:
  pre:
    - sudo apt-add-repository ppa:mosquitto-dev/mosquitto-ppa -y
    - sudo apt-get update -y
    - sudo apt-get install mosquitto -y
    - sudo echo "listener 1883" >> /etc/mosquitto/mosquitto.conf
    - sudo echo "listener 1884" >> /etc/mosquitto/mosquitto.conf
    - sudo echo "protocol websockets" >> /etc/mosquitto/mosquitto.conf
    - sudo service mosquitto restart
test:
  pre:
    - go get github.com/axw/gocov/gocov
    - go get github.com/mattn/goveralls
    - if ! go get github.com/golang/tools/cmd/cover; then go get golang.org/x/tools/cmd/cover; fi
  override:
    - go test -v -cover -race -coverprofile=/home/ubuntu/coverage.out
  post:
    - /home/ubuntu/.go_workspace/bin/goveralls -coverprofile=/home/ubuntu/coverage.out -service=circle-ci -repotoken=$COVERALLS_TOKEN
